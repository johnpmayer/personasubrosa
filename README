Slightly modified version of https://lukasa.co.uk/2013/04/Writing_A_Persona_Identity_Provider/
